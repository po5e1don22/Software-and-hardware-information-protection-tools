Безопасность в сети играет важную роль, особенно в современных условиях. В частности, это касается корпоративных сетей — в них следует применять решения, которые делали бы безопасным трафик на уровнях 2–7 модели OSI. Такими решениями являются межсетевые экраны (МЭ, иначе — брандмауэры и файрволы).

МЭ способны, в частности:

- **Остановить подмену трафика**. Если, например, компания обменивается данными с одним из своих подразделений, и при этом её IP‑адреса известны, то в принципе можно замаскировать свой трафик под данные офиса, но отправить его с другого IP. В этом случае МЭ обнаружит подмену и не даст ему попасть внутрь сети компании.
    
- **Защитить корпоративную сеть от DDoS‑атак**, то есть ситуаций, когда происходят попытки вывода из строя ресурсов компании путём отправки им множества запросов с зараженных устройств. Если система умеет распознавать такие атаки, она формирует определенную закономерность и передает ее МЭ с целью дальнейшей фильтрации злонамеренного трафика.
    
- **Заблокировать передачу данных на неизвестный IP‑адрес** в случае, например, когда сотрудник компании скачал вредоносный файл и заразил свой компьютер, что может привести к утечке важной корпоративной информации. При попытке вируса передать информацию на неизвестный IP‑адрес МЭ может автоматически остановить это.
    

В зависимости от того, на каких уровнях модели OSI могут работать МЭ, они подразделяются на типы, представленные на рис. 1.

![[Pasted image 20250601172924.png]]

### Типы межсетевых экранов с точки зрения модели OSI

С точки зрения данной модели, различают следующие типы межсетевых экранов:

- управляемые коммутаторы;
    
- пакетные фильтры;
    
- шлюзы сеансового уровня;
    
- инспекторы состояния;
    
- посредники прикладного уровня.
    

**Управляемые коммутаторы** могут использоваться в качестве МЭ, поскольку они могут производить фильтрацию трафика между сетями или узлами сети. Но фильтрация эта производится на канальном уровне по MAC-адресам, из-за чего они не могут быть использованы для фильтрации трафика из внешних сетей, например, из Интернета. Практически все производимые в настоящее время управляемые коммутаторы поддерживают технологию виртуальных сетей (VLAN), позволяющую создавать группы хостов, трафик которых полностью изолирован от других узлов сети. Таким образом можно, например, отделить хосты и серверы бухгалтерии от хостов других сотрудников компании. При реализации политики безопасности в корпоративной сети, построенной на управляемых коммутаторах, последние могут быть мощным и достаточно дешёвым решением. Поскольку управляемые коммутаторы имеют дело только с протоколами канального уровня, МЭ, выполненные на их основе фильтруют трафик с очень высокой скоростью.

**Пакетные фильтры** являются самым распространённым типом МЭ, работают на сетевом уровне и контролируют прохождение трафика на основе информации, содержащейся в заголовке пакетов. Многие МЭ данного типа могут работать и с протоколами транспортного уровня, такими как TCP или UDP. Технология пакетной фильтрации в настоящее время реализована в большинстве маршрутизаторов и даже в некоторых управляемых коммутаторах. В заголовках сетевых пакетов могут анализироваться следующие параметры:

- IP-адреса Отправителя и Получателя;
    
- тип транспортного протокола;
    
- поля служебных заголовков протоколов сетевого и транспортного уровней;
    
- порты Отправителя и Получателя.
    

Пакетные фильтры можно применять в следующих местах сети:

- пограничных маршрутизаторах;
    
- операционных системах;
    
- персональных МЭ.
    

Пакетные фильтры обладают высоким быстродействием, поскольку обычно проверяют данные только в заголовках сетевого и транспортного уровней, а, значит, будучи встроенными в пограничные маршрутизаторы, идеально подходят для размещения на границе с сетью с низкой степенью доверия. Но пакетные фильтры не могут анализировать протоколы более высоких уровней сетевой модели OSI, и они обычно уязвимы для атак, которые используют подделку сетевого адреса.

**Шлюзы сеансового уровня** исключают прямое взаимодействие внешних хостов с узлом, расположенным в локальной сети, выступая в качестве посредника (Proxy), проверяя все входящие пакеты на их допустимость на основании текущей фазы соединения. Они гарантируют, что ни один сетевой пакет не будет пропущен, если он не принадлежит ранее установленному соединению. После появления запроса на установление соединения в специальную таблицу помещаются: адреса Отправителя и Получателя, используемые протоколы сетевого и транспортного уровня, состояние соединения и т. д. Если соединение установлено, то пакеты, передаваемые в рамках данной сессии, копируются в локальную сеть без дополнительной фильтрации. По завершении сеанса связи сведения о нём удаляются из данной таблицы. Если далее появляются пакеты, «притворяющиеся» пакетами уже завершённого соединения, то такие пакеты отбрасываются.

Поскольку МЭ данного типа исключает прямое взаимодействие между двумя узлами, он является единственным связующим элементом между внешней и внутренней сетями. Это создаёт видимость того, что на все запросы из внешней сети отвечает шлюз, что делает практически невозможным определение топологии защищаемой сети. Кроме того, так как контакт между узлами устанавливается только при условии его допустимости, МЭ данного типа предотвращает возможность реализации DDoS-атаки, присущей пакетным фильтрам.

Но хотя эта технология является весьма эффективной, она обладает серьёзным недостатком: у шлюзов сеансового уровня отсутствует возможность проверки содержания поля данных, что позволяет злоумышленнику передавать «троянских коней» в защищаемые ими сети.

**Посредники прикладного уровня**, к которым, в частности, относится файрвол веб-приложений, как и шлюзы сеансового уровня, исключают прямое взаимодействие двух узлов. Но они способны «понимать» контекст передаваемого трафика. МЭ, поддерживающие эту технологию, содержат несколько приложений-посредников (Application Proxy), каждое из которых работает со своим прикладным протоколом. Такие МЭ способны выявлять в передаваемых сообщениях и блокировать несуществующие или нежелательные последовательности команд, что зачастую означает DDoS-атаку. Также они могут запрещать использование некоторых команд (например, FTP PUT, дающей пользователю возможность записывать информацию на FTP сервер).

Посредник прикладного уровня может определять тип передаваемой информации и, например, заблокировать почтовое сообщение, содержащее исполняемый файл. Также МЭ данного типа может проверять аргументы входных данных. Например, аргумент имени пользователя длиной в 100 символов либо содержащий бинарные данные является, по крайней мере, подозрительным. Ещё они способны выполнять аутентификацию пользователя и проверять, что SSL-сертификаты подписаны конкретным центром. МЭ прикладного уровня работают с многими протоколами: HTTP, FTP, SMTP, POP, IMAP, [Telnet](https://ru.wikipedia.org/wiki/Telnet) и другими.

Недостатками данного типа межсетевых экранов являются:

- большие затраты времени и ресурсов на анализ каждого пакета, а значит, они не подходят для приложений реального времени;
    
- невозможность автоматического подключения поддержки новых сетевых приложений и протоколов, так как для каждого из них необходим свой агент.
    

**Инспекторы состояния** обладают преимуществами всех типов МЭ, перечисленных выше, осуществляют фильтрацию трафика с  сеансового по прикладной уровень и совмещают в себе высокую производительность и защищённость. Данный МЭ позволяет контролировать:

- каждый передаваемый пакет — на основе таблицы правил;
    
- каждую сессию — на основе таблицы состояний;
    
- каждое приложение — на основе разработанных посредников.
    

В данном типе МЭ фильтрация трафика осуществляется по принципу шлюзов сеансового уровня, но они не вмешиваются в процесс установления соединения между узлами. Поэтому их производительность, существенно выше, чем у посредников прикладного уровня и шлюзов сеансового уровня. Она сравнима с производительностью пакетных фильтров.

Несомненным достоинством инспекторов состояния является их прозрачность для пользователя: для клиентского программного обеспечения не потребуется дополнительная настройка. Данные МЭ имеют также большие возможности расширения. При появлении новой службы или нового протокола прикладного уровня для его поддержки достаточно добавить несколько шаблонов. К недостаткам инспекторов состояний можно отнести то, что им, по сравнению с посредниками прикладного уровня, свойственна более низкая защищённость.

### Типы межсетевых экранов с точки зрения реализации

С точки зрения реализации различают аппаратные и программные межсетевые экраны.

**Аппаратные МЭ** — это, как правило, специальное оборудование, составляющие которого (процессоры, платы и т.п.) спроектированы специально для обработки трафика и работающие на специальном программном обеспечении, что необходимо для увеличения производительности оборудования. Примерами аппаратного межсетевого экрана выступают такие устройства, как Cisco ASA (рис. 2), FortiGate, Cisco FirePower, UserGate и другие.  Аппаратные МЭ мощнее программных, но и существенно дороже. Часто их стоимость в разы выше, чем у программных аналогов.

**Программный МЭ** — это программное обеспечение, которое устанавливается на реальное или виртуальное устройство. Через такой МЭ перенаправляется весь трафик внутрь рабочей сети. К программным МЭ относятся, например, брандмауэр в Windows и iptables в Linux. Программные МЭ, как правило, существенно дешевле аппаратных и могут устанавливаться не только на границах сети, но и на рабочих станциях пользователей. Из основных недостатков — более низкая пропускная способность и сложность настройки в ряде случаев.

На рис. 3 представлен пример ACL (Access List — список доступа) для одного из интерфейсов МЭ. В списке подробно расписано, какие протоколы транспортного уровня из каких сетей могут проходить из DMZ (демилитаризованной зоны сети компании) внутрь сети компании и на какие порты устройств сети (красные рамки). Также указывается всё то, что запрещено (всё остальное — 100 deny any any). Отдельно имеется список того, что разрешено и запрещено любым сетям из Интернета (Extend IP access list From-Outside).

---
---
## Типы межсетевых экранов

Межсетевые экраны делятся на несколько типов в зависимости от метода фильтрации. Каждый новый тип превосходит более ранние поколения сетевых экранов, однако все они задействуют одни и те же основные технологии.

Выделяют несколько типов файрволов в зависимости от подхода к:

1. отслеживанию подключений;
2. созданию правил фильтрации;
3. ведению журналов аудита.

Каждый из этих типов используется на разных уровнях стандартизированной модели коммуникаций – [OSI (модели взаимодействия открытых систем).](https://www.networkworld.com/article/3239677/the-osi-model-explained-and-how-to-easily-remember-its-7-layers.html) Эта модель дает более полное представление о том, как каждый сетевой экран работает с подключениями.

### Брандмауэр со статической пакетной фильтрацией

Брандмауэры со статической пакетной фильтрацией, или инспекторы, не хранящие данных о состоянии, работают на сетевом уровне модели OSI (уровень 3). Они выполняют базовую фильтрацию, проверяя все передаваемые по сети пакеты данных по сведениям об отправителе и получателе. При этом ранее разрешенные подключения не отслеживаются. То есть каждое подключение проверяется каждый раз, когда пакет данных передается по сети.

Фильтрация выполняется по IP-адресам, номерам портов и пакетным протоколам. На самом базовом уровне такие файрволы предотвращают неразрешенные прямые подключения между устройствами из разных сетей.

Правила фильтрации формулируются на основе списка управления доступом, созданного вручную. Такие списки не отличаются гибкостью и не могут обеспечить эффективной фильтрации нежелательного трафика без снижения удобства использования сети. Для эффективного использования статической фильтрации необходимо регулярно пересматривать списки в ручном режиме. Подобный метод подходит для небольших сетей, однако он может вызвать определенные сложности при администрировании крупных.

При невозможности считывать протоколы прикладного уровня сообщения, доставленные с пакетом данных, не могут быть прочитаны. А если сообщения нельзя прочитать, то сетевые экраны с пакетной фильтрацией не сумеют обеспечить достаточной защиты.

### Шлюзы сеансового уровня

Такие шлюзы функционируют на сеансовом уровне (уровень 5 OSI). Эти брандмауэры проверяют, не содержат ли передаваемые данные функциональных пакетов, и разрешают постоянное соединение между двумя сетями, если все в порядке. После этого сетевой экран перестает следить за разрешенными подключениями.

Шлюзы сеансового уровня отличаются от шлюзов уровня приложений только подходом к обработке подключений.

Оставлять подключения без контроля опасно: с помощью легитимных инструментов можно открыть соединение, через которое злоумышленник впоследствии без труда проникнет в сеть.

### Инспекторы состояния

Эти файрволы также называются сетевыми экранами с динамической пакетной фильтрацией. Они отличаются от статических фильтров способностью непрерывно отслеживать подключения и запоминать проверенные. Поначалу они использовались на транспортном уровне (уровень 4 OSI), но сейчас они могут контролировать трафик на разных уровнях, в том числе на уровне приложений (уровень 7 OSI).

Инспекторы состояния, как и их аналоги со статической фильтрацией, пропускают трафик или блокируют его на основании технических параметров, таких как пакетные протоколы, IP-адреса или номера портов. Однако эти сетевые экраны могут отслеживать и фильтровать трафик на основе данных о состоянии подключения, которые хранятся в таблице состояния.

Правила фильтрации обновляются на основе таблицы состояния, в которую экранирующий маршрутизатор записывает данные о предыдущих подключениях.

Чаще всего фильтрация осуществляется на основе правил, установленных администратором во время настройки компьютера и сетевого экрана. Однако таблица состояния позволяет файрволам с динамической фильтрацией самостоятельно принимать решения, используя данные о предыдущих подключениях для обучения. Например, типы трафика, которые провоцировали сбои в работе, будут отсеиваться. Благодаря своей гибкости инспекторы состояния стали одной из самых распространенных категорий щитов.

### Шлюз уровня приложений

Шлюзы уровня приложений, или межсетевые экраны прикладного уровня (уровень 7 OSI), фильтруют трафик по протоколам прикладного уровня. Они выполняют не только проверку приложений, или глубокую проверку пакетов (DPI), но и проверку состояния.

По уровню защиты шлюзы уровня приложений максимально приближаются к физическим барьерам. Уникальность этих типов сетевых экранов заключается в том, что они выполняют роль двух дополнительных хостов (прокси-серверов), один из которых взаимодействует с внешними сетями, а другой – с внутренними хостами.

Шлюзы уровня приложений фильтруют трафик по данным прикладного уровня. В этом состоит их отличие от аналогов, которые выполняют пакетную фильтрацию по IP-адресам, номерам портов и базовым пакетным протоколам (UDP, ICMP). Сетевые экраны, работающие с FTP, HTTP, DNS и другими протоколами, выполняют более глубокую проверку и перекрестную фильтрацию по различным свойствам данных.

Как стражи, стоящие у дверей, они проверяют и оценивают все поступающие данные. Если с пакетом данных все в порядке, они пропускают его к пользователю.

Однако у такой тщательной проверки есть один недостаток – иногда обработка безопасных входящих данных замедляет работу приложения.

### Межсетевые экраны нового поколения (NGFW)

В цифровом мире появляется много новых угроз, для борьбы с которыми требуются все более эффективные решения. Межсетевые экраны нового поколения сочетают возможности традиционных сетевых экранов и систем предотвращения сетевых вторжений, помогая противостоять современным угрозам.

Сетевые экраны нового поколения, созданные для борьбы с конкретными угрозами, например со сложным вредоносным ПО, выполняют углубленную проверку и идентификацию таких угроз. Это комплексное решение для блокирования угроз, которое чаще всего используется в корпоративных и сложных сетях.

### Гибридный брандмауэр

Как следует из названия, такие межсетевые экраны объединяют несколько типов брандмауэров в одной частной сети.

---
---
## Типы фаерволов и их функционал

### L3/L4 пакетные фильтры — stateless TCAM-based 

TCAM (Ternary Content-Addressable Memory) — это технология для быстрого поиска и фильтрации данных в сетевых устройствах, которая используется в фаервол-системах. Она представляет собой массив ячеек памяти, каждый из которых может хранить три значения: 0, 1 или 2. Это позволяет быстро определять, соответствует ли пакет заданным критериям и правилам.

У неё есть две разновидности: 

1. Stateless TCAM - это тип TCAM без состояния. То есть когда мы не запоминаем тот самый state.
    
2. Stateful TCAM — это когда мы запоминаем информацию из предыдущих запросов и держим её в отдельной таблице. Это ускоряет поиск.
    

Технология TCAM быстрая на read, но у нее есть минусы: высокая стоимость, необходимость в охлаждении и её долго перепрограммировать. Однако эта технология может применяться практически на всех устройствах сетевого уровня: от l2 коммутаторов до фаерволов, маршрутизаторов.

### Full-software processing L3/L4/dumb DPI — iptables/nftables/ipfw/pf/etc

Программные решения можно запускать практически на любом x86. Их слабое место — высокая нагрузка на CPU. Разработчики стремятся писать такие фаероволы, которые быстро работают и едят меньше ресурсов. Потому что для любого фаервола, в том числе host-based, очень важно, чтобы он не съедал большую часть мощности процессора. 

### DPI (Deep Packet Inspection) и IPS (Intrusion prevention system)

DPI — это технология, которая позволяет анализировать содержимое пакетов данных: заголовки, откуда и куда.

IPS (Intrusion Prevention System) — это система, которая предназначена для предотвращения вторжения в компьютерную систему.

IPS отличается от DPI тем, что имеет дополнительные условия. Например, был трафик 30 000 TCP-соединений на какой-то destination, а потом резко возрос в три раза, при этом в течение недели по статистике такого никогда не было. Соответственно, фаервол определяет это как какую-то аномалию и срезает трафик, которого никогда не было.

---
---
---

https://habr.com/ru/companies/nauka/articles/869440/
https://www.kaspersky.ru/resource-center/definitions/firewall
https://habr.com/ru/companies/slurm/articles/752176/